
Checksums
=========

Create and verify GPG-signed MD5 checksums for all files in a
directory tree.


Rationale
---------

The general purpose of creating checksums for files and comparing
them over time is to determine whether files have changed. Either
accidentally or maliciously.

Several intrusion detection systems already exist that serve this
purpose, among other things. So why this script?

* I don't want to bother with the complexities of an 
  enterprise-grade IDS.

* I don't want a central database of checksums.
  Instead, I want one checksum file (.checksums) per directory,
  in order to be able to easily copy directories around and still
  be able to verify their checksums.

* Incremental creation/update of checksums.
  Assuming that I/you trust data integrity on the system where
  the checksums are generated.


Prerequisites
-------------

- ruby
- gpgme ruby bindings
 - either the gpgme gem
 - or the Debian package libgpgme-ruby


Usage
-----

TODO


Pitfalls
--------

Whose keys are they anyway?

When run as an ordinary user, the script uses that user's keyring.

When run in a root login session, i.e. `su -', not plain `su' or `sudo',
the script tries to use root's keyring. Possibly unsuccessfully, when
there's no gpg-agent running for root.

When run via `sudo -E', the keyring of the user running sudo is used!

When run via `sudo', depending on sudo configuration, this is either
the same as `sudo -E' or it fails when there's no gpg-agent for root.

In order to have sudo pass the GPG_AGENT_INFO environment variable
through to the checksums script, add the following lines to
/etc/sudoers or to a file in /etc/sudoers.d; use `visudo' or
`visudo -f' for editing these files.

Cmnd_Alias CHECKSUMS = /usr/local/bin/checksums # or wherever you install the script
Defaults!CHECKSUMS env_keep+=GPG_AGENT_INFO
